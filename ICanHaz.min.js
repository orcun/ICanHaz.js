(function(f){var k=function(){var c=function(){};c.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(a,b,d,e){if(!e)this.context=b,this.buffer=[];if(!this.includes("",a))if(e)return a;else{this.send(a);return}a=this.render_code(a);a=this.render_pragmas(a);a=this.render_section(a,b,d);if(e)return this.render_tags(a,b,d,e);this.render_tags(a,b,d,e)},send:function(a){a!=""&&this.buffer.push(a)},render_code:function(a){if(!this.includes("*",
a))return a;return a.replace(RegExp(this.otag+"\\*\\s*(.+?)\\s*"+this.ctag,"mg"),function(a,d){return eval(d)})},render_pragmas:function(a){if(!this.includes("%",a))return a;var b=this;return a.replace(RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(a,e,h){if(!b.pragmas_implemented[e])throw{message:"This implementation of mustache doesn't understand the '"+e+"' pragma"};b.pragmas[e]={};h&&(a=h.split("="),b.pragmas[e][a[0]]=a[1]);return""})},render_partial:function(a,b,d){a=this.trim(a);
if(!d||d[a]===void 0)throw{message:"unknown_partial '"+a+"'"};if(typeof b[a]!="object")return this.render(d[a],b,d,!0);return this.render(d[a],b[a],d,!0)},render_section:function(a,b,d){if(!this.includes("#",a)&&!this.includes("^",a))return a;var e=this;return a.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.*)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(a,c,f,g){a=e.find(f,b);if(c=="^")return!a||e.is_array(a)&&a.length===0?e.render(g,b,d,!0):"";else if(c==
"#")return e.is_array(a)?e.map(a,function(a){return e.render(g,e.create_context(a),d,!0)}).join(""):e.is_object(a)?e.render(g,e.create_context(a),d,!0):typeof a==="function"?a.call(b,g,function(a){return e.render(a,b,d,!0)}):a?e.render(g,b,d,!0):""})},render_tags:function(a,b,d,e){for(var c=this,f=function(){return RegExp(c.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+c.ctag+"+","g")},j=f(),g=function(a,e,g){switch(e){case "!":return"";case "=":return c.set_delimiters(g),j=f(),"";case ">":return c.render_partial(g,
b,d);case "{":return c.find(g,b);default:return c.escape(c.find(g,b))}},a=a.split("\n"),i=0;i<a.length;i++)a[i]=a[i].replace(j,g,this),e||this.send(a[i]);if(e)return a.join("\n")},set_delimiters:function(a){a=a.split(" ");this.otag=this.escape_regex(a[0]);this.ctag=this.escape_regex(a[1])},escape_regex:function(a){if(!arguments.callee.sRE)arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return a.replace(arguments.callee.sRE,"\\$1")},find:function(a,b){a=this.trim(a);
if(a=="")return b;var d;b[a]===!1||b[a]===0||b[a]?d=b[a]:(this.context[a]===!1||this.context[a]===0||this.context[a])&&(d=this.context[a]);if(typeof d==="function")return d.apply(b);if(d!==void 0)return d;return""},includes:function(a,b){return b.indexOf(this.otag+a)!=-1},escape:function(a){return String(a===null?"":a).replace(/&(?!\w+;)|["<>\\]/g,function(a){switch(a){case "&":return"&amp;";case "\\":return"\\\\";case '"':return'"';case "<":return"&lt;";case ">":return"&gt;";default:return a}})},
create_context:function(a){if(this.is_object(a))return a;else{var b=".";if(this.pragmas["IMPLICIT-ITERATOR"])b=this.pragmas["IMPLICIT-ITERATOR"].iterator;var d={};d[b]=a;return d}},is_object:function(a){return a&&typeof a=="object"},is_array:function(a){return Object.prototype.toString.call(a)==="[object Array]"},trim:function(a){return a.replace(/^\s*|\s*$/g,"")},map:function(a,b){if(typeof a.map=="function")return a.map(b);else{for(var d=[],e=a.length,c=0;c<e;c++)d.push(b(a[c]));return d}}};return{name:"mustache.js",
version:"0.3.0",to_html:function(a,b,d,e){var f=new c;if(e)f.send=e;f.render(a,b,d);if(!e)return f.buffer.join("\n")}}}();window.ich=new function(){var c=this;c.VERSION="0.9";c.templates={};c.partials={};c.addTemplate=function(a,b){if(c[a])throw"Invalid name: "+a+".";if(c.templates[a])throw'Template " + name + " exists';c.templates[a]=b;c[a]=function(b,e){var b=b||{},h=k.to_html(c.templates[a],b,c.partials);return e?h:f(h)}};c.addPartial=function(a,b){if(c.partials[a])throw'Partial " + name + " exists';
else c.partials[a]=b};c.grabTemplates=function(){f('script[type="text/html"]').each(function(a,b){var d=f(typeof a==="number"?b:a),e="".trim?d.html().trim():f.trim(d.html());c[d.hasClass("partial")?"addPartial":"addTemplate"](d.attr("id"),e);d.remove()})};c.clearAll=function(){for(var a in c.templates)delete c[a];c.templates={};c.partials={}};c.refresh=function(){c.clearAll();c.grabTemplates()}};f(function(){ich.grabTemplates()})})(window.jQuery||window.Zepto);
